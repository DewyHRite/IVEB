<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        body{
          height: auto;
          width: auto;
          zoom: 80%; /* Adjust the zoom to 80% */
          margin-top: 80px; /* Add this line to push the content below the navbar */
          font-family: Arial, sans-serif;
          padding: 20px;
          background: linear-gradient(-45deg, #3fd2c7, #99ddff, #00458b, #3fd2c7);
          background-size: 400% 400%; /* Ensure smooth animation */
          animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        } 
        
        .header {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          z-index: 1001; /* Ensure header is above other elements */

        }

        .navbar {
          position: fixed; /* Sticks the navbar to a fixed position */
          display: flex;
          align-items: center;
          justify-content: space-between;
          max-width: auto;
          left: 0;
          right: 0;
          margin: 0 auto;
          padding: 20px 200px;
          z-index: 1002; ;
          opacity: 1;
          background-color:  #000000; /* Add background color to navbar */
          height: 60px; /* Fixed height for the navbar */
        }

        .navbar .logo a {
          font-size: 1.8rem;
          text-decoration: none;
          color: #00458b;
        }

        .navbar .links {
          display: flex;
          align-items: center;
          list-style: none;
          gap: 35px;
        }

        .navbar .links a {
          font-weight: 500;
          text-decoration: none;
          color: #fff;
          padding: 10px 0;
          transition: 0.2s ease;
        }

        .navbar .links a:hover {
          color: #00458b;
        }

        .navbar .buttons a {
          text-decoration: none;
          color: #fff;
          font-size: 1rem;
          padding: 15px 0;
          transition: 0.2s ease;
        }

        .navbar .buttons a:not(:last-child) {
          margin-right: 30px;
        }


        /* Hamburger menu styles */
        #menu-toggle {
          display: none;
        }

        #hamburger-btn {
          font-size: 1.8rem;
          color: #fff;
          cursor: pointer;
          display: none;
          order: 1;
        }

        @media screen and (max-width: 1023px) {
          .navbar .logo a {
            font-size: 1.5rem;
          }

          .links {
            position: fixed;
            left: -100%;
            top: 75px;
            width: 100%;
            height: 100vh;
            padding-top: 50px;
            background: #000000;
            flex-direction: column;
            transition: 0.3s ease;
          }

          .navbar #menu-toggle:checked ~ .links {
            left: 0;
          }

          .navbar #hamburger-btn {
            display: block;
          }

          .header .buttons {
            display: none;
          }
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);          
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(12px);
            transition: background-color 0.3s ease; /* Smooth transition for background color */
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            margin-bottom: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .table th {
            background: #00458b;
            color: #fff;
        }

        .search-bar {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        .search-bar input {
            padding: 8px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .search-bar button {
            padding: 8px 12px;
            margin-left: 10px;
            background: #00458b;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-bar button:hover {
            background: #003366;
        }
    </style>
</head>
<body>    
    <div>
        <header class="header">
        <nav class="navbar">
            <nav class="navbar">
            <img width="5%" height="auto" src="Assets/LogoB.png" alt="Picture not found" style="margin-right: 100px;"/>
            <h3 class="logo"><a align="left">Island Vybz Electric Bikes</a></h3>
            <input type="checkbox" id="menu-toggle" />
            <label for="menu-toggle" id="hamburger-btn">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
                <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            </label>
            <ul class="links">
            <li style="white-space: nowrap;"><a href="AboutUs.html">About Us</a></li>
            <li>
                <div>
                <a href="Login.html">Logout</a>
                </div>
            </li>
            </ul>
        </nav>
        </header>
  </div>
  <h1 align="center">Dashboard</h1>
    <div class="container">

        <!-- Gender Frequency Section -->
        <div class="section" id="genderFrequencySection">
            <h2>Gender Frequency</h2>
            <table class="table" id="genderFrequencyTable">
                <thead>
                    <tr>
                        <th>Gender</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be dynamically populated -->
                </tbody>
            </table>
        </div>

        <!-- User Frequency Section -->
        <div class="section" id="userFrequencySection">
            <h2>User Frequency</h2>
            <table class="table" id="userFrequencyTable">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be dynamically populated -->
                </tbody>
            </table>
        </div>

        <!-- All Invoices Section -->
        <div class="section" id="allInvoicesSection">
            <h2>All Invoices</h2>
            <div class="search-bar">
                <input type="text" id="searchTRN" placeholder="Search by TRN">
                <button onclick="showInvoices()">Search</button>
            </div>
            <table class="table" id="allInvoicesTable">
                <thead>
                    <tr>
                        <th>Invoice Number</th>
                        <th>TRN</th>
                        <th>Date</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be dynamically populated -->
                </tbody>
            </table>
        </div>

        <!-- User Invoices Section -->
        <div class="section" id="userInvoicesSection">
            <h2>User Invoices</h2>
            <table class="table" id="userInvoicesTable">
                <thead>
                    <tr>
                        <th>Invoice Number</th>
                        <th>TRN</th> 
                        <th>Date</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be dynamically populated -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="dashboard.js"></script>
    <script>
        // ShowUserFrequency: Displays user frequency by gender and age group
        function showUserFrequency() {
            const registrationData = JSON.parse(localStorage.getItem('RegistrationData')) || [];
            const genderCounts = { Male: 0, Female: 0, Other: 0 };
            const ageGroups = { '18-25': 0, '26-35': 0, '36-50': 0, '50+': 0 };

            const today = new Date();

            registrationData.forEach(user => {
                // Count genders
                if (genderCounts[user.gender] !== undefined) {
                    genderCounts[user.gender]++;
                }

                // Calculate age
                const birthDate = new Date(user.dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                // Count age groups
                if (age >= 18 && age <= 25) {
                    ageGroups['18-25']++;
                } else if (age >= 26 && age <= 35) {
                    ageGroups['26-35']++;
                } else if (age >= 36 && age <= 50) {
                    ageGroups['36-50']++;
                } else if (age > 50) {
                    ageGroups['50+']++;
                }
            });

            // Populate the gender table
            const genderFrequencyTable = document.getElementById('genderFrequencyTable').querySelector('tbody');
            genderFrequencyTable.innerHTML = '';

            Object.entries(genderCounts).forEach(([gender, count]) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${gender}</td><td>${count}</td>`;
                genderFrequencyTable.appendChild(row);
            });

            // Populate the age group table
            const userFrequencyTable = document.getElementById('userFrequencyTable').querySelector('tbody');
            userFrequencyTable.innerHTML = '';

            Object.entries(ageGroups).forEach(([ageGroup, count]) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${ageGroup}</td><td>${count}</td>`;
                userFrequencyTable.appendChild(row);
            });
        }

        // ShowInvoices: Displays all invoices and allows searching by TRN
        function showInvoices() {
            const searchTRN = document.getElementById('searchTRN').value.trim();
            const allInvoices = JSON.parse(localStorage.getItem('InvoiceData')) || {};
            const allInvoicesTable = document.getElementById('allInvoicesTable').querySelector('tbody');

            allInvoicesTable.innerHTML = '';

            Object.entries(allInvoices).forEach(([trn, invoices]) => {
                if (!searchTRN || trn === searchTRN) {
                    invoices.forEach(invoice => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${invoice.invoiceNumber}</td> <!-- Display the stored invoice number -->
                            <td>${trn}</td>
                            <td>${new Date(invoice.date).toLocaleDateString()}</td>
                            <td>$${invoice.total.toFixed(2)}</td>
                        `;
                        allInvoicesTable.appendChild(row);
                    });
                }
            });

            if (searchTRN) {
                console.log(`Invoices for TRN ${searchTRN}:`, allInvoices[searchTRN] || []);
            }
        }

        // GetUserInvoices: Displays all invoices for a specific user based on TRN
        function getUserInvoices() {
            const allInvoices = JSON.parse(localStorage.getItem('InvoiceData')) || {};
            const userInvoicesTable = document.getElementById('userInvoicesTable').querySelector('tbody');

            userInvoicesTable.innerHTML = ''; // Clear the table before populating

            // Iterate through all invoices for all users
            Object.entries(allInvoices).forEach(([trn, invoices]) => {
                invoices.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${invoice.invoiceNumber}</td>
                        <td>${trn}</td> <!-- Populate TRN in its own column -->
                        <td>${new Date(invoice.date).toLocaleDateString()}</td>
                        <td>$${invoice.total.toFixed(2)}</td>
                    `;
                    userInvoicesTable.appendChild(row);
                });
            });
        }

        // Initialize the dashboard
        window.onload = function () {
            showUserFrequency();
            getUserInvoices();
        };
        

        // Validate session on page load
        window.addEventListener('DOMContentLoaded', () => {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            
            if (!currentUser) {
                // Redirect to login if no active session
                window.location.href = 'Login.html';
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (currentUser) {
                const navbar = document.querySelector('.navbar .links');
                const userGreeting = document.createElement('li');
                userGreeting.textContent = `Hi, ${currentUser.name}`;
                userGreeting.style.color = '#fff';
                userGreeting.style.fontWeight = 'bold';
                userGreeting.style.marginLeft = '0px'; // Adjust spacing
                userGreeting.style.whiteSpace = 'nowrap'; // Prevent text wrapping
                navbar.appendChild(userGreeting);
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            const logoutButton = document.querySelector('.navbar .links a[href="Login.html"]');

            if (logoutButton) {
                logoutButton.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default link behavior

                    // Clear session storage to log out the user
                    sessionStorage.removeItem('currentUser');

                    // Redirect to the login page
                    window.location.href = 'Login.html';
                });
            }
        });
    </script>
</body>
</html>